# HAProxy Demo アーキテクチャ詳細

## システム概要

このシステムは、高負荷に対応可能なWebアプリケーションのアーキテクチャを実装したデモです。HAProxyによるロードバランシングと、水平スケーリング可能なSpring Bootアプリケーションで構成されています。

## コンポーネント

### 1. HAProxy (ロードバランサー)

- **役割**: トラフィックの分散、ヘルスチェック、統計情報の提供
- **ポート**: 
  - 80: Webトラフィック
  - 8404: 統計情報ダッシュボード
- **設定**:
  - ラウンドロビン方式での負荷分散
  - 5秒間隔でのヘルスチェック
  - 自動的な障害検知とフェイルオーバー

### 2. Spring Boot Application (Jetty組み込み)

- **役割**: ビジネスロジックの実行、APIの提供
- **特徴**:
  - ステートレス設計
  - 水平スケーリング対応
  - Actuatorによるヘルスチェックエンドポイント
  - Prometheusメトリクスの公開

### 3. モニタリングスタック (オプション)

- **Prometheus**: メトリクス収集と保存
- **Grafana**: メトリクスの可視化

## スケーリング戦略

### 水平スケーリング

```bash
# インスタンス数を増やす
docker-compose up -d --scale spring-app=10
```

### 負荷分散アルゴリズム

HAProxyは以下のアルゴリズムをサポート:
- roundrobin (デフォルト)
- leastconn
- source
- uri

## セキュリティ考慮事項

1. **ネットワーク分離**: Docker内部ネットワークでの通信
2. **統計情報の保護**: Basic認証による保護
3. **非ルートユーザー**: コンテナ内でのアプリケーション実行

## パフォーマンスチューニング

### JVMチューニング
- ヒープサイズの適切な設定
- ガベージコレクションの最適化

### HAProxyチューニング
- maxconnの調整
- タイムアウト値の最適化

### Jettyチューニング
- スレッドプールサイズの調整
- コネクションプールの設定 